<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel | DharTee Services</title>

  <script>
    if (sessionStorage.getItem('isAuthenticated') !== 'true') {
      window.location.href = 'login.html';
    }
  </script>

  <!-- Tailwind + fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

  <!-- Your custom CSS -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* small local tweaks for the SEO snippet and image preview */
    .seo-snippet {
      border-radius: .5rem;
      padding: .75rem;
      background: #fff;
      border: 1px solid #e5e7eb;
    }
    .thumb-sm { width: 56px; height: 40px; object-fit: cover; border-radius: 6px; }
  </style>
</head>
<body class="bg-slate-50 font-poppins min-h-screen">

  <div id="toast" class="fixed right-6 bottom-6 z-50 hidden"></div>

  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-72 bg-white border-r hidden lg:block">
      <div class="p-6">
        <h1 class="text-xl font-semibold text-slate-800 mb-3">DharTee — Admin</h1>
        <nav class="space-y-2 text-sm">
          <a class="flex items-center gap-3 p-2 rounded hover:bg-slate-100" href="#"><i data-feather="edit-3" class="w-4 h-4"></i> Compose</a>
          <a class="flex items-center gap-3 p-2 rounded hover:bg-slate-100" href="#"><i data-feather="list" class="w-4 h-4"></i> Posts</a>
          <a class="flex items-center gap-3 p-2 rounded hover:bg-slate-100" href="#"><i data-feather="settings" class="w-4 h-4"></i> Settings</a>
        </nav>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-6">
      <!-- Form panel -->
      <section class="mb-8">
        <div class="bg-white p-6 rounded-xl shadow">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h2 id="form-title" class="text-2xl font-bold text-slate-800">Publish New Post</h2>
              <p class="text-sm text-slate-500">Create and configure your blog article.</p>
            </div>
            <div class="flex gap-3 items-center">
              <label class="text-sm text-slate-600">Dark Mode</label>
              <input id="dark-toggle" type="checkbox" class="h-5 w-9" />
            </div>
          </div>

          <form id="post-form" class="space-y-6">
            <input type="hidden" id="post-id">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold mb-1">Post Title</label>
                <input id="post-title" required class="w-full px-4 py-2 border rounded" placeholder="Enter main headline" />
              </div>

              <div>
                <label class="block text-sm font-semibold mb-1">Custom URL (Slug)</label>
                <div class="flex gap-2">
                  <input id="post-slug" required class="flex-1 px-4 py-2 border rounded" placeholder="my-first-blog-post" />
                  <button id="generate-slug" type="button" class="px-3 py-2 bg-slate-100 rounded border text-sm">Auto</button>
                </div>
                <p class="text-xs text-slate-500 mt-1">Edit as needed. Slug will be sanitized automatically.</p>
              </div>

              <div>
                <label class="block text-sm font-semibold mb-1">Category</label>
                <input id="post-category" class="w-full px-4 py-2 border rounded" placeholder="e.g., Taxation" />
              </div>

              <div>
                <label class="block text-sm font-semibold mb-1">Status</label>
                <select id="post-status" class="w-full px-4 py-2 border rounded">
                  <option value="published">Published</option>
                  <option value="draft">Draft</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold mb-1">Excerpt <span id="excerpt-count" class="text-xs text-slate-500">0/200</span></label>
              <textarea id="post-content" rows="3" maxlength="200" class="w-full px-4 py-2 border rounded" placeholder="Short summary for listing..."></textarea>
            </div>

            <!-- Image upload + preview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-semibold mb-1">Featured Image</label>
                <input id="post-image-file" type="file" accept="image/*" class="block w-full text-sm" />
                <input id="post-image-url" type="url" class="mt-2 w-full px-3 py-2 border rounded" placeholder="Or enter image URL (optional)" />
                <p class="text-xs text-slate-500 mt-1">Image will be uploaded to Firebase Storage when selecting from computer.</p>
                <div id="featured-preview" class="mt-3 hidden">
                  <img id="featured-preview-img" class="w-48 h-32 object-cover rounded shadow-sm" src="" alt="preview" />
                </div>
              </div>

              <div>
                <label class="block text-sm font-semibold mb-1">OG Image (optional)</label>
                <input id="og-image-file" type="file" accept="image/*" class="block w-full text-sm" />
                <input id="og-image-url" type="url" class="mt-2 w-full px-3 py-2 border rounded" placeholder="Or OG image URL" />
                <div id="og-preview" class="mt-3 hidden">
                  <img id="og-preview-img" class="w-48 h-32 object-cover rounded shadow-sm" src="" alt="og preview" />
                </div>
              </div>

              <div>
                <label class="block text-sm font-semibold mb-1">SEO — Meta Title</label>
                <input id="meta-title" class="w-full px-4 py-2 border rounded" maxlength="70" placeholder="Meta title (max 70 chars)" />
                <label class="block text-sm font-semibold mt-3 mb-1">Meta Description <span id="meta-count" class="text-xs text-slate-500">0/160</span></label>
                <textarea id="meta-desc" rows="4" maxlength="160" class="w-full px-3 py-2 border rounded" placeholder="Meta description"></textarea>
                <label class="block text-sm font-semibold mt-3 mb-1">Focus Keyword</label>
                <input id="focus-keyword" class="w-full px-4 py-2 border rounded" placeholder="Primary target keyword" />
                <div class="mt-4 seo-snippet">
                  <div id="seo-title-preview" class="text-sky-700 font-medium text-sm">Meta title preview</div>
                  <div id="seo-url-preview" class="text-xs text-slate-500 mt-0.5">https://yourdomain.com/blog/<span id="seo-slug">my-post</span></div>
                  <div id="seo-desc-preview" class="text-sm text-slate-700 mt-1">Meta description preview...</div>
                </div>
              </div>
            </div>

            <div>
              <div class="flex items-center justify-between mb-2">
                <label class="block text-sm font-semibold">Full Article Content</label>
                <div class="flex gap-2">
                  <button type="button" id="compose-view-btn" class="px-3 py-1.5 rounded bg-slate-100 text-sm font-medium">Compose</button>
                  <button type="button" id="html-view-btn" class="px-3 py-1.5 rounded bg-white text-sm font-medium">HTML</button>
                </div>
              </div>
              <div id="editor-container" style="height: 360px;"></div>
              <textarea id="html-editor" class="hidden mt-2 w-full px-3 py-2 border rounded" style="min-height: 360px;"></textarea>
            </div>

            <div class="flex items-center gap-3 pt-4 border-t">
              <button id="submit-button" type="submit" class="px-6 py-2 bg-sky-600 text-white rounded font-semibold">Publish Post</button>
              <button id="cancel-edit" type="button" class="px-5 py-2 bg-gray-200 rounded hidden">Cancel Edit</button>
              <div class="ml-auto text-sm text-slate-500">Last saved: <span id="last-saved">never</span></div>
            </div>
          </form>
        </div>
      </section>

      <!-- Posts list + filters -->
      <section>
        <div class="bg-white p-6 rounded-xl shadow">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-slate-800">Manage Existing Posts</h2>
            <div class="flex items-center gap-3">
              <input id="search-input" class="px-3 py-2 border rounded" placeholder="Search by title or keyword..." />
              <select id="filter-category" class="px-3 py-2 border rounded">
                <option value="">All Categories</option>
              </select>
              <select id="filter-status" class="px-3 py-2 border rounded">
                <option value="">All Status</option>
                <option value="published">Published</option>
                <option value="draft">Draft</option>
              </select>
              <button id="refresh-list" class="px-3 py-2 rounded bg-slate-100">Refresh</button>
            </div>
          </div>

          <div id="posts-list" class="space-y-3">
            <p class="text-slate-500">Loading posts...</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-storage-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    // initialize firebase (firebase-config.js must define firebaseConfig)
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const storage = firebase.storage();
  </script>

  <!-- Main admin script -->
  <script src="admin.js"></script>

  <script>
    feather.replace();
  </script>
</body>
</html>
